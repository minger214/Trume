<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Trume - All Projects</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Google Fonts - SF Pro (iOS style font) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="css/shared.css" rel="stylesheet">
    <script src="js/shared.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#007AFF',
                        secondary: '#5856D6',
                        dark: '#000000',
                        darkSecondary: '#1C1C1E',
                        light: '#FFFFFF',
                        lightGray: '#8E8E93',
                        mediumGray: '#3A3A3C',
                        darkGray: '#2C2C2E',
                        success: '#34C759',
                        warning: '#FF9500',
                        error: '#FF3B30',
                    },
                    fontFamily: {
                        'sf-pro': ['Inter', 'sans-serif']
                    },
                },
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            }
            .progress-gradient {
                background: linear-gradient(92deg, rgba(212, 52, 254, 1) 0%, rgba(130, 71, 229, 1) 100%);
            }
            .card-overlay {
                background: linear-gradient(180deg, rgba(0, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0.8) 100%);
            }
            /* iOS Screen styles moved to shared.css */
            .nav-button {
                transition: all 0.2s ease;
            }
            .nav-button:active {
                transform: scale(0.95);
                opacity: 0.8;
                background-color: rgba(255, 255, 255, 0.1);
            }
            .project-card {
                transition: all 0.2s ease;
                perspective: 1000px;
            }
            .project-card:active {
                transform: scale(0.98);
            }
            .animate-fade-in {
                animation: fadeIn 0.5s ease-in-out;
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .toast {
                background-color: rgba(0, 0, 0, 0.8);
                backdrop-filter: blur(20px);
                padding: 12px 16px;
                border-radius: 20px;
                color: white;
                font-size: 15px;
                display: flex;
                align-items: center;
                animation: fadeIn 0.3s ease-in-out;
            }
            .toast i {
                margin-right: 8px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body class="bg-black text-white font-sf-pro min-h-screen flex items-center justify-center">
    <div class="ios-screen">
    <!-- Status Bar - iOS Style -->
    <div class="h-8 bg-dark z-50 flex items-center justify-between px-5">
        <div class="text-xs text-white font-medium">9:41</div>
        <div class="flex items-center space-x-2 text-white text-xs">
            <i class="fa fa-signal"></i>
            <i class="fa fa-wifi"></i>
            <i class="fa fa-battery-full"></i>
        </div>
    </div>

    <!-- Navigation Bar - iOS Style -->
    <nav class="flex items-center justify-between px-5 py-4 bg-dark/90 backdrop-blur z-20">
        <div class="flex items-center">
            <button id="back-button" class="p-2 rounded-full nav-button">
                <i class="fa fa-arrow-left text-white text-xl"></i>
            </button>
            <div class="ml-4 flex items-center">
                <div class="flex items-center">
                    <span class="text-light text-lg font-semibold">All Projects</span>
                </div>
            </div>
        </div>
        <div class="flex items-center space-x-4">
            <button id="sort-button" class="p-2 rounded-full nav-button">
                <i class="fa fa-sort text-white text-xl"></i>
            </button>
            <button id="help-button" class="p-2 rounded-full nav-button">
                <i class="fa fa-home text-white text-xl"></i>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto p-5 pb-8">
        <!-- Projects Grid -->
        <div id="projects-container" class="grid grid-cols-3 gap-4">
            <!-- Projects will be dynamically generated here -->
        </div>
    </main>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="fixed inset-0 pointer-events-none z-50 flex items-center justify-center"></div>

    <script>
        // 共享函数已通过window对象挂载，无需导入
        
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化共享功能
            window.initializeSharedFunctions();
            
            // 生成项目样式
            const projectStyles = [
                { name: 'Artistic', filter: 'contrast(120%) brightness(110%) saturate(120%)' },
                { name: 'Natural', filter: 'contrast(110%) brightness(105%) saturate(90%)' },
                { name: 'Vintage', filter: 'sepia(30%) contrast(110%)' },
                { name: 'Modern', filter: 'contrast(130%) brightness(105%) saturate(130%)' },
                { name: 'Warm', filter: 'sepia(20%) hue-rotate(-10deg) contrast(110%)' },
                { name: 'Cool', filter: 'hue-rotate(20deg) contrast(110%)' }
            ];
            
            // 渲染项目
            function renderProjects() {
                const projectsContainer = document.getElementById('projects-container');
                let projects = window.getProjects();
                
                // 按保存时间排序（最新的在前）
                const currentSort = localStorage.getItem('projectSort') || 'newest';
                projects.sort((a, b) => {
                    return currentSort === 'newest' 
                        ? new Date(b.createdAt) - new Date(a.createdAt) 
                        : new Date(a.createdAt) - new Date(b.createdAt);
                });
                
                if (projects.length === 0) {
                    // 显示空状态
                    projectsContainer.innerHTML = `
                        <div class="col-span-3 text-center py-20">
                            <i class="fa fa-folder-open-o text-light/30 text-6xl mb-4"></i>
                            <p class="text-lightGray">No projects saved yet</p>
                            <p class="text-mediumGray text-sm mt-2">Generate and save projects to see them here</p>
                        </div>
                    `;
                    return;
                }
                
                // 清空容器
                projectsContainer.innerHTML = '';
                
                // 渲染每个项目
                projects.forEach((project, index) => {
                    // 为所有超过第一行的卡片添加相同的垂直间距
                    const isBeyondFirstRow = index >= 3;
                    
                    // 创建项目卡片
                    const card = document.createElement('div');
                    card.className = `relative project-card cursor-pointer transition-all duration-300 animate-fade-in ${isBeyondFirstRow ? 'mt-8' : ''}`;
                    card.dataset.id = project.id;
                    card.style.animationDelay = `${index * 50}ms`;
                    
                    // 项目卡片内容
                    card.innerHTML = `
                        <div class="rounded-2xl overflow-hidden aspect-[3/4] shadow-lg">
                            <img 
                                src="${project.imageUrl}" 
                                alt="${project.style.name} style project" 
                                class="w-full h-full object-cover transition-all duration-500"
                                style="filter: ${project.status === 'completed' ? project.style.filter : 'grayscale(50%) brightness(70%)'}"
                            >
                            <div class="absolute inset-0 card-overlay flex flex-col justify-end p-3">
                                <p class="text-[11px] text-white text-center text-shadow font-medium">
                                    ${project.style.name}
                                </p>
                            </div>
                        </div>
                        <!-- Creation Time Display -->
                        <div class="absolute -bottom-5 left-0 right-0 px-3">
                            <p class="completion-time text-[10px] text-center mt-1 
                                ${project.status === 'completed' ? 'text-success' : 'text-white'}">
                                ${formatDate(project.createdAt)}
                            </p>
                        </div>
                    `;
                    
                    // 添加删除按钮
                    const deleteButton = document.createElement('div');
                    deleteButton.className = 'absolute top-1 right-1 w-5 h-5 rounded-full bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-200';
                    deleteButton.innerHTML = '<span class="text-white text-xs">✕</span>';
                    deleteButton.addEventListener('click', function(e) {
                        e.stopPropagation(); // 阻止冒泡
                        // 添加点击动画
                        this.style.transform = 'scale(0)';
                        this.style.opacity = '0';
                        setTimeout(() => {
                            deleteProject(project.id);
                        }, 200);
                    });
                    
                    // 确保卡片支持悬停效果
                    card.classList.add('group');
                    card.appendChild(deleteButton);
                    
                    // 添加点击事件
                    card.addEventListener('click', function() {
                        // 保存当前选择的项目ID和样式
                        localStorage.setItem('selectedProjectId', project.id);
                        localStorage.setItem('selectedProject', JSON.stringify(project));
                        // 跳转到项目详情页面
                        window.location.href = 'portfolio-selected.html';
                    });
                    
                    // 添加到容器
                    projectsContainer.appendChild(card);
                });
            }
            
            // 删除项目
            function deleteProject(projectId) {
                // 保存当前滚动位置
                const scrollTop = window.scrollY;
                
                const projects = window.getProjects();
                const updatedProjects = projects.filter(project => project.id !== projectId);
                window.saveProjects(updatedProjects);
                renderProjects();
                
                // 恢复滚动位置
                setTimeout(() => {
                    window.scrollTo(0, scrollTop);
                }, 10);
                
                window.showToast('Project removed', 'fa-check-circle', 3000);
            }
            
            // 格式化日期
            function formatDate(dateString) {
                const date = new Date(dateString);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);
                
                if (diffMins < 60) {
                    return `${diffMins}m ago`;
                } else if (diffHours < 24) {
                    return `${diffHours}h ago`;
                } else if (diffDays < 7) {
                    return `${diffDays}d ago`;
                } else {
                    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                }
            }
            
            // 返回按钮功能
            const backButton = document.getElementById('back-button');
            if (backButton) {
                backButton.addEventListener('click', function() {
                    window.buttonClickAnimation(this);
                    window.navigateTo('portfolio-generating.html', 150);
                });
            }
            
            // 排序按钮功能
            const sortButton = document.getElementById('sort-button');
            if (sortButton) {
                sortButton.addEventListener('click', function() {
                    window.buttonClickAnimation(this);
                    // 旋转动画
                    this.classList.add('rotate-180');
                    setTimeout(() => {
                        this.classList.remove('rotate-180');
                    }, 500);
                    
                    // 切换排序方式（最新的在前/最早的在前）
                    const currentSort = localStorage.getItem('projectSort') || 'newest';
                    const newSort = currentSort === 'newest' ? 'oldest' : 'newest';
                    localStorage.setItem('projectSort', newSort);
                    
                    // 重新渲染项目
                    renderProjects();
                    
                    // 显示排序提示
                    window.showToast(`Sorted by ${newSort === 'newest' ? 'newest first' : 'oldest first'}`, 'fa-info-circle', 3000);
                });
            }
            
            // 首页按钮功能
            const homeButton = document.getElementById('help-button');
            if (homeButton) {
                homeButton.addEventListener('click', function() {
                    window.buttonClickAnimation(this);
                    window.navigateTo('home.html', 150);
                });
            }
            
            // 添加模拟数据用于测试
            function addMockProjects() {
                // 检查是否已有项目数据
                if (window.getProjects().length === 0) {
                    const mockProjects = [];
                    const projectStyles = [
                        { name: 'Artistic', filter: 'contrast(120%) brightness(110%) saturate(120%)' },
                        { name: 'Natural', filter: 'contrast(110%) brightness(105%) saturate(90%)' },
                        { name: 'Vintage', filter: 'sepia(30%) contrast(110%)' },
                        { name: 'Modern', filter: 'contrast(130%) brightness(105%) saturate(130%)' },
                        { name: 'Warm', filter: 'sepia(20%) hue-rotate(-10deg) contrast(110%)' },
                        { name: 'Cool', filter: 'hue-rotate(20deg) contrast(110%)' }
                    ];
                    
                    // 创建12个模拟项目，分布在不同的日期
                    for (let i = 0; i < 12; i++) {
                        // 生成不同日期的项目
                        const date = new Date();
                        date.setDate(date.getDate() - i);
                        
                        mockProjects.push({
                            id: 'mock-' + i,
                            imageUrl: `https://picsum.photos/400/500?random=${i}`,
                            style: projectStyles[i % projectStyles.length],
                            status: 'completed',
                            createdAt: date.toISOString()
                        });
                    }
                    
                    window.saveProjects(mockProjects);
                }
            }
            
            // 添加模拟数据并初始化页面
            addMockProjects();
            renderProjects();
        });
    </script>
    </div>
</body>
</html>